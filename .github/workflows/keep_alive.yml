name: Keep Streamlit App Alive (Browser)

on:
  schedule:
    # 4時間おきに実行 (1日6回: 0時, 4時, 8時, 12時, 16時, 20時 UTC)
    - cron: '0 0,4,8,12,16,20 * * *'
  workflow_dispatch:

jobs:
  wake-up:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Selenium
        run: |
          pip install selenium webdriver-manager

      - name: Visit App with Selenium
        shell: python
        run: |
          from selenium import webdriver
          from selenium.webdriver.chrome.options import Options
          from selenium.webdriver.chrome.service import Service
          from webdriver_manager.chrome import ChromeDriverManager
          import time

          APP_URL = "https://narouevalu-pgj8tq2tdlccjybdx88kvd.streamlit.app/"

          chrome_options = Options()
          chrome_options.add_argument("--headless")
          chrome_options.add_argument("--no-sandbox")
          chrome_options.add_argument("--disable-dev-shm-usage")

          service = Service(ChromeDriverManager().install())
          driver = webdriver.Chrome(service=service, options=chrome_options)

          print(f"Visiting {APP_URL} ...")
          try:
              driver.get(APP_URL)
              time.sleep(30)
              print(f"Page Title: {driver.title}")
              print("Success! App should be awake.")
          except Exception as e:
              print(f"Error: {e}")
          finally:
              driver.quit()
